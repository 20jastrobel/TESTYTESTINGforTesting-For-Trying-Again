pwd -P
ls -la
sed -n "1,260p" AGENTS.md
rg --files
rg -n "phase1_qiskit_builtin_long_highfid_results_run1|hardcoded|suzuki|trotter|vqe|VQE" -S pydephasing README.md Tests
python - <<"PY"
import json
from pathlib import Path
p=Path("Tests/phase1_qiskit_builtin_long_highfid_results_run1.json")
obj=json.loads(p.read_text())
print("top_keys", list(obj.keys()))
print("settings_keys", list(obj.get("settings", {}).keys()))
print("num_times", len(obj.get("time_series", [])))
print("first_ts_keys", list(obj.get("time_series", [{}])[0].keys()) if obj.get("time_series") else [])
print("results_keys", list(obj.get("results", {}).keys()))
print("meta_keys", list(obj.get("metadata", {}).keys()))
PY
sed -n "1,260p" Tests/hubbard_dimer_suzuki_trotter_hardcoded_bridge_standalone.py
sed -n "1,260p" Tests/hubbard_dimer_suzuki_trotter_standalone.py
rg -n "argparse|add_argument|output|json|initial_state_amplitudes_qn_to_q0|trajectory|summary_metrics|suzuki_order|trotter_steps|main\(" Tests/hubbard_dimer_suzuki_trotter_hardcoded_bridge_standalone.py
sed -n "260,620p" Tests/hubbard_dimer_suzuki_trotter_hardcoded_bridge_standalone.py
sed -n "620,980p" Tests/hubbard_dimer_suzuki_trotter_hardcoded_bridge_standalone.py
python - <<"PY"
import json
from pathlib import Path
for p in [
    "Tests/phase1_qiskit_builtin_long_highfid_results_run1.json",
    "Tests/phase1_hardcoded_uccsd_long_highfid_results_run1.json",
    "Tests/phase1_hardcoded_uccsd_long_highfid_results_run2.json",
    "Tests/phase1_qiskit_builtin_long_highfid_results_run2.json",
]:
    obj=json.loads(Path(p).read_text())
    print("\n===",p)
    print("top",list(obj.keys()))
    s=obj.get("settings",{})
    print("settings",{k:s.get(k) for k in ["num_sites","hopping_t","onsite_u","dv","boundary","spin_orbital_ordering","initial_state","t_final","num_times","suzuki_order","trotter_steps","initial_state_label_qn_to_q0"] if k in s})
    print("has_amp", "initial_state_amplitudes_qn_to_q0" in s, "len", len(s.get("initial_state_amplitudes_qn_to_q0",{})))
    tr=obj.get("trajectory",[])
    print("trajectory_len",len(tr))
    print("traj_keys",list(tr[0].keys()) if tr else [])
    sm=obj.get("summary_metrics",{})
    print("summary_keys",list(sm.keys())[:12])
PY
python - <<"PY"
import json
from pathlib import Path
p=Path("Tests/phase1_qiskit_builtin_long_highfid_results_run1.json")
obj=json.loads(p.read_text())
s=obj["settings"]
print("initial_state",s.get("initial_state"))
print("initial_state_label_qn_to_q0",s.get("initial_state_label_qn_to_q0"))
amps=s.get("initial_state_amplitudes_qn_to_q0",{})
for i,(k,v) in enumerate(amps.items()):
    print(i,k,v)
    if i>=10: break
print("amp_count",len(amps))
print("vqe_uccsd keys", list(obj.get("vqe_uccsd",{}).keys()))
PY
rg -n "hardcoded_vqe_uccsd|phase1_hardcoded_uccsd_long_highfid|vqe_uccsd_hardcoded|initial_state_amplitudes_qn_to_q0" Tests pydephasing -S
rg -n "vqe_uccsd_hardcoded|hardcoded_uccsd|phase1_hardcoded|Hardcoded UCCSD|hardcoded_vqe" Tests/*.py Tests/**/*.py pydephasing/**/*.py -S
rg -n "phase1|long_highfid|hardcoded_uccsd|run1|run2|comparison" README.md Tests/README.md Tests/*.md Tests/*.txt Tests/*.py -S
sed -n "1,260p" Tests/README.md
sed -n "1,260p" README.md
sed -n "1,260p" Tests/phase1_hardcoded_runtime_run1.txt
python - <<"PY"
import json
from pathlib import Path
p=Path("Tests/phase1_hardcoded_vs_qiskit_uccsd_long_highfid_comparison.json")
obj=json.loads(p.read_text())
print(json.dumps(obj.get("run_configuration",{}), indent=2))
print("\nfiles", obj.get("source_files",{}))
print("\nsummary", json.dumps(obj.get("summary",{}), indent=2)[:2000])
PY
sed -n "1,260p" Tests/phase1_hardcoded_runtime_run2.txt
sed -n "1,260p" Tests/phase1_qiskit_runtime_run1.txt
cat Tests/phase1_hardcoded_vs_qiskit_uccsd_long_highfid_comparison.json
rg -n "Phase 1 strict parameter-locked comparison|phase1_parameter_lock_execution_accuracy_comparison|trajectory_deltas|first crossing" -S Tests pydephasing
rg -n "HardcodedUCCSDAnsatz|phase1_hardcoded_uccsd|hubbard_dimer_suzuki_trotter_uccsd_long_highfid_results|vqe_uccsd_hardcoded|initial_state_amplitudes_qn_to_q0" Tests/quantum_test/vqe_latex_python_pairs_test.ipynb pydephasing/quantum/vqe_latex_python_pairs_test.ipynb Tests/*.ipynb Tests/*.py -S
python - <<"PY"
import json
from pathlib import Path
for p in [
"Tests/hubbard_dimer_suzuki_trotter_uccsd_long_highfid_results.json",
"Tests/hubbard_dimer_suzuki_trotter_uccsd_results.json",
"Tests/hubbard_dimer_suzuki_trotter_results.json",
]:
    obj=json.loads(Path(p).read_text())
    print("\n",p)
    print("description",obj.get("description"))
    print("top",list(obj.keys())[:10])
    print("settings",obj.get("settings",{}))
    if "hardcoded_vqe_uccsd" in obj:
        print("hardcoded_vqe_uccsd keys",list(obj["hardcoded_vqe_uccsd"].keys()))
PY
python - <<"PY"
import json
from pathlib import Path
p=Path("Tests/phase1_hardcoded_uccsd_long_highfid_results_run1.json")
obj=json.loads(p.read_text())
print(obj.get("description"))
print(obj.get("hardcoded_vqe_uccsd", {}).keys())
PY
rg -n "Hardcoded UCCSD VQE \+ hardcoded second-order Suzuki-Trotter Hubbard dimer dynamics|hardcoded second-order Suzuki-Trotter|hf_bitstring" -S Tests pydephasing
python - <<"PY"
import json
from pathlib import Path
for nb_path in [
    Path("pydephasing/quantum/vqe_latex_python_pairs.ipynb"),
    Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb"),
]:
    nb=json.loads(nb_path.read_text())
    print(f"\n=== {nb_path} ===")
    for i,cell in enumerate(nb.get("cells",[])):
        if cell.get("cell_type")!="code":
            continue
        src="".join(cell.get("source",[]))
        if any(k in src for k in [
            "class HardcodedUCCSDAnsatz",
            "def apply_exp_pauli_polynomial",
            "def apply_exp_pauli_term",
            "def vqe_minimize",
            "def hf_initial_state_from_bitstring",
            "def run_hardcoded",
            "description",
        ]):
            print(f"--- cell {i} ---")
            print(src[:1600])
            print("...\n")
PY
python - <<"PY"
import json, re
from pathlib import Path
for nb_path in [Path("pydephasing/quantum/vqe_latex_python_pairs.ipynb"), Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb")]:
    nb=json.loads(nb_path.read_text())
    print(f"\n== {nb_path} ==")
    for i,cell in enumerate(nb.get("cells",[])):
        if cell.get("cell_type")!="code":
            continue
        src="".join(cell.get("source",[]))
        if "HardcodedUCCSDAnsatz" in src or "apply_exp_pauli_polynomial" in src and "suzuki" in src.lower() or "def hardcoded_uccsd_excitations" in src or "def prepare_state" in src and "HardcodedUCCSDAnsatz" in src:
            print("cell",i)
            # print around class declaration
            if "HardcodedUCCSDAnsatz" in src:
                idx=src.index("HardcodedUCCSDAnsatz")
                st=max(0,idx-500)
                en=min(len(src),idx+2500)
                print(src[st:en])
            else:
                print(src[:1400])
            print("---")
PY
rg -n "energy_trotter|n_up_site0_trotter|n_dn_site0_trotter|doublon_trotter|trajectory|suzuki|trotter_steps|Hardcoded UCCSD VQE" pydephasing/quantum/vqe_latex_python_pairs_test.ipynb Tests/quantum_test/vqe_latex_python_pairs_test.ipynb -S
python - <<"PY"
import json
from pathlib import Path
keywords=["energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter","trajectory","suzuki_order","trotter_steps","Hardcoded UCCSD VQE","initial_state_amplitudes_qn_to_q0","phase1_hardcoded"]
for nb_path in [Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb"),Path("Tests/quantum_test/vqe_latex_python_pairs_test.ipynb")]:
    nb=json.loads(nb_path.read_text())
    print(f"\n== {nb_path} ==")
    found=False
    for i,cell in enumerate(nb.get("cells",[])):
        if cell.get("cell_type")!="code":
            continue
        src="".join(cell.get("source",[]))
        if any(k in src for k in keywords):
            found=True
            print(f"cell {i}")
            for k in keywords:
                if k in src:
                    print("  has",k)
            print(src[:1200].replace("\n","\\n")[:1200])
            print("---")
    if not found:
        print("no matching code cells")
PY
python - <<"PY"
import json
from pathlib import Path
nb_path=Path("pydephasing/quantum/qpe_hard_coded_latex_python_pairs.ipynb")
nb=json.loads(nb_path.read_text())
keywords=["energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter","trajectory","suzuki_order","trotter_steps","t_final","num_times","initial_state_amplitudes_qn_to_q0","Hubbard dimer"]
for i,cell in enumerate(nb.get("cells",[])):
    if cell.get("cell_type")!="code":
        continue
    src="".join(cell.get("source",[]))
    if any(k in src for k in keywords):
        print(f"cell {i}")
        for k in keywords:
            if k in src:
                print("  has",k)
        print(src[:1400])
        print("---")
PY
sed -n "1,320p" Tests/salvaged_vqe.py
rg -n "HardcodedUCCSDAnsatz|apply_exp_pauli_polynomial|evolve|trotter|phase1|initial_state_amplitudes_qn_to_q0|hubbard_dimer|trajectory" Tests/salvaged_vqe.py pydephasing/quantum/*.py -S
sed -n "320,760p" Tests/salvaged_vqe.py
rg -n "n_up_site0_trotter|n_dn_site0_trotter|doublon_trotter|energy_trotter|initial_state_amplitudes_qn_to_q0|vqe_uccsd_hardcoded" -S --glob "!*.json"
rg --files pydephasing | head -n 20
find pydephasing -maxdepth 3 -name "__init__.py" -print
ls -la pydephasing/quantum
rg -n "def build_hubbard_hamiltonian|def mode_index|SPIN_UP|SPIN_DN|bravais_nearest_neighbor_edges|n_sites_from_dims" pydephasing/quantum/hubbard_latex_python_pairs.py
rg -n "class PauliPolynomial|def return_polynomial|def pw2strng|def nqubit|def fermion_plus_operator|def fermion_minus_operator" pydephasing/quantum/pauli_polynomial_class.py pydephasing/quantum/pauli_words.py
sed -n "1,280p" pydephasing/quantum/hubbard_latex_python_pairs.py
sed -n "1,280p" pydephasing/quantum/pauli_polynomial_class.py
python - <<"PY"
from pydephasing.quantum.hubbard_latex_python_pairs import build_hubbard_hamiltonian
print(build_hubbard_hamiltonian is not None)
PY
python - <<"PY"
import json
from pathlib import Path
nb=Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb")
ns={}
payload=json.loads(nb.read_text())
for cell in payload.get("cells",[]):
    if cell.get("cell_type")!="code":
        continue
    src="".join(cell.get("source",[]))
    if "Final benchmark: hardcoded VQE vs Qiskit VQE" in src:
        continue
    exec(src,ns)
print("has", all(k in ns for k in ["HardcodedUCCSDAnsatz","vqe_minimize","basis_state","hartree_fock_bitstring","half_filled_num_particles","apply_exp_pauli_polynomial"]))
print("nkeys", len(ns))
PY
python - <<"PY"
import json, numpy as np
from pathlib import Path
from pydephasing.quantum.hubbard_latex_python_pairs import build_hubbard_hamiltonian
nb=Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb")
ns={}
for cell in json.loads(nb.read_text()).get("cells",[]):
    if cell.get("cell_type")!="code":
        continue
    src="".join(cell.get("source",[]))
    if "Final benchmark: hardcoded VQE vs Qiskit VQE" in src:
        continue
    exec(src,ns)
L=2
num_particles=tuple(ns["half_filled_num_particles"](L))
H=build_hubbard_hamiltonian(dims=L,t=1.0,U=4.0,v=0.0,repr_mode="JW",indexing="blocked",pbc=True)
hf_bits=ns["hartree_fock_bitstring"](n_sites=L,num_particles=num_particles,indexing="blocked")
psi_ref=np.asarray(ns["basis_state"](2*L,hf_bits),dtype=complex)
ans=ns["HardcodedUCCSDAnsatz"](dims=L,num_particles=num_particles,reps=2,repr_mode="JW",indexing="blocked",include_singles=True,include_doubles=True)
res=ns["vqe_minimize"](H,ans,psi_ref,restarts=3,seed=7,maxiter=1800,method="SLSQP")
print("energy",res.energy)
print("theta_len",len(res.theta),"best_restart",res.best_restart)
PY
python - <<"PY"
from qiskit_nature.second_q.mappers import JordanWignerMapper
print("qiskit_nature ok", JordanWignerMapper is not None)
PY
python Tests/phase1_l2_hardcoded_match_harness.py
python Tests/phase1_l2_hardcoded_match_harness.py
sed -n "1,260p" hardcoded_vs_qiskit_l2_match_report_iter0.md
python - <<"PY"
import json
from pathlib import Path
for p in [
"hardcoded_vs_qiskit_l2_match_metrics_iter0.json",
"hardcoded_vs_qiskit_l2_match_metrics_iter1.json",
"hardcoded_vs_qiskit_l2_match_final_metrics.json",
]:
    path=Path(p)
    print("\n==",p,"exists",path.exists())
    if not path.exists():
        continue
    obj=json.loads(path.read_text())
    if p.endswith("final_metrics.json"):
        print("pass",obj.get("pass"),"final_iter",obj.get("final_iteration_index"))
        fm=obj.get("final_metrics",{})
        print("accept",fm.get("acceptance",{}).get("checks"))
        td=fm.get("trajectory_deltas",{})
        for k in ["fidelity","energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter"]:
            if k in td:
                print(k,td[k]["max_abs_delta"])
        print("gs",fm.get("ground_state_energy",{}).get("abs_delta"))
    else:
        print("pass",obj.get("acceptance",{}).get("pass"))
        td=obj.get("trajectory_deltas",{})
        for k in ["fidelity","energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter"]:
            if k in td:
                print(k,td[k]["max_abs_delta"])
        print("gs",obj.get("ground_state_energy",{}).get("abs_delta"))
PY
sed -n "1,260p" hardcoded_vs_qiskit_l2_match_report_iter1.md
python - <<"PY"
import json
from pathlib import Path
obj=json.loads(Path("trotter_term_audit_l2.json").read_text())
print("audit keys", list(obj.keys()))
print("diagA reduction", obj["diagnostic_a_baseline_initial_amplitudes_legacy_modes"]["mismatch_reduction_per_metric"])
print("max_abs_coeff_delta", obj["coefficient_audit"]["max_abs_coeff_delta"])
print("missing terms", len(obj["ordered_terms"]["hardcoded_native_exyz_order"]), len(obj["ordered_terms"]["qiskit_to_list_ixyz_order"]))
PY
sed -n "1,260p" hardcoded_vs_qiskit_l2_match_final_report.md
python Tests/phase1_l2_hardcoded_match_harness.py
python - <<"PY"
import json
from pathlib import Path
for p in ["hardcoded_vs_qiskit_l2_match_metrics_iter0.json","hardcoded_vs_qiskit_l2_match_metrics_iter1.json","hardcoded_vs_qiskit_l2_match_final_metrics.json"]:
    obj=json.loads(Path(p).read_text())
    if p.endswith("final_metrics.json"):
        m=obj["final_metrics"]
        print(p,"PASS",obj["pass"],"iter",obj["final_iteration_index"])
        print(m["acceptance"]["checks"])
        print({k:m["trajectory_deltas"][k]["max_abs_delta"] for k in ["fidelity","energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter"]})
    else:
        print(p,"PASS",obj["acceptance"]["pass"]) 
        print({k:obj["trajectory_deltas"][k]["max_abs_delta"] for k in ["fidelity","energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter"]})
print("\nfinal report snippet:")
print(Path("hardcoded_vs_qiskit_l2_match_final_report.md").read_text().splitlines()[0:35])
PY
sed -n "1,280p" Tests/Hubbard_VQE_Qiskit.py
sed -n "280,620p" Tests/Hubbard_VQE_Qiskit.py
python - <<"PY"
import json
from pathlib import Path
for p in ["Tests/hardcoded_vqe_results.json","Tests/vqe_hardcoded_vs_qiskit_comparison.json","Tests/vqe_l4_longrun_results.json"]:
    print("\n==",p)
    obj=json.loads(Path(p).read_text())
    print("keys",list(obj.keys()))
    if "results" in obj:
        print("results count",len(obj["results"]))
        for row in obj["results"][:5]:
            if isinstance(row,dict):
                print({k:row.get(k) for k in ["L","lattice_sites","hardcoded_vqe_energy","qiskit_vqe_energy","hardcoded_delta","qiskit_delta"] if k in row})
    if "comparison" in obj:
        print("comparison keys",list(obj["comparison".strip()].keys()) if isinstance(obj.get("comparison"),dict) else type(obj.get("comparison")))
    if "qiskit_vqe_config" in obj:
        print("qiskit cfg",obj["qiskit_vqe_config"]) 
PY
python - <<"PY"
import json
from pathlib import Path
for p in ["Tests/vqe_hardcoded_vs_qiskit_comparison.json","Tests/vqe_l4_longrun_results.json"]:
    print("\n==",p)
    obj=json.loads(Path(p).read_text())
    if p.endswith("comparison.json"):
        cmp=obj.get("comparison",[])
        print("entries",len(cmp))
        for row in cmp:
            print({k:row.get(k) for k in ["lattice_sites","hardcoded_vqe_energy","qiskit_vqe_energy","exact_energy","delta_hardcoded_vs_qiskit","delta_hardcoded_vs_exact","delta_qiskit_vs_exact"]})
    else:
        print("results type",type(obj.get("results")))
        r=obj.get("results")
        if isinstance(r,dict):
            for k,v in r.items():
                print(k,v if not isinstance(v,(dict,list)) else (list(v.keys()) if isinstance(v,dict) else f"list[{len(v)}]"))
        elif isinstance(r,list):
            print("list len",len(r))
            for row in r[:3]:
                print(row)
        print("qiskit config",obj.get("qiskit_vqe_config"))
PY
python - <<"PY"
import json, time, numpy as np
from pathlib import Path
from pydephasing.quantum.hubbard_latex_python_pairs import build_hubbard_hamiltonian
nb=Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb")
ns={}
for cell in json.loads(nb.read_text()).get("cells",[]):
    if cell.get("cell_type")!="code": continue
    src="".join(cell.get("source",[]))
    if "Final benchmark: hardcoded VQE vs Qiskit VQE" in src: continue
    exec(src,ns)
for L,maxiter in [(3,600),(4,300)]:
    t0=time.time()
    npart=tuple(ns["half_filled_num_particles"](L))
    H=build_hubbard_hamiltonian(dims=L,t=1.0,U=4.0,v=0.0,repr_mode="JW",indexing="blocked",pbc=True)
    hf=ns["hartree_fock_bitstring"](n_sites=L,num_particles=npart,indexing="blocked")
    psi=np.asarray(ns["basis_state"](2*L,hf),dtype=complex)
    ans=ns["HardcodedUCCSDAnsatz"](dims=L,num_particles=npart,reps=2,repr_mode="JW",indexing="blocked",include_singles=True,include_doubles=True)
    res=ns["vqe_minimize"](H,ans,psi,restarts=2,seed=7,maxiter=maxiter,method="SLSQP")
    print("L",L,"energy",res.energy,"params",ans.num_parameters,"time",time.time()-t0)
PY
python - <<"PY"
import json
from pathlib import Path
root=Path(".")

l3_cmp=json.loads((root/"Tests/vqe_hardcoded_vs_qiskit_comparison.json").read_text())
l3_row=None
for row in l3_cmp.get("comparison",[]):
    if int(row.get("lattice_sites",-1))==3:
        l3_row=row
        break
if l3_row is None:
    raise RuntimeError("L3 entry missing in Tests/vqe_hardcoded_vs_qiskit_comparison.json")

hard_l3=float(l3_row["hardcoded_vqe_energy"])
qiskit_l3=float(l3_row["qiskit_vqe_energy"])
delta_l3=abs(hard_l3-qiskit_l3)

qk_l4=json.loads((root/"Tests/vqe_l4_longrun_results.json").read_text())
qiskit_l4=float(qk_l4["results"]["best_vqe_energy_observed"])

hc_l4_src=json.loads((root/"pydephasing/quantum/exports/qpe_hardcoded_sector_run_L4_blocked.json").read_text())
hard_l4=float(hc_l4_src["results"]["E_vqe"])
delta_l4=abs(hard_l4-qiskit_l4)

threshold=1e-4
payload={
  "generated_utc": __import__("datetime").datetime.utcnow().isoformat()+"Z",
  "description": "Follow-up L=3/L=4 hardcoded-vs-Qiskit comparison using existing test artifacts after L=2 phase1 lock-match.",
  "sources": {
    "l3": "Tests/vqe_hardcoded_vs_qiskit_comparison.json",
    "l4_qiskit": "Tests/vqe_l4_longrun_results.json",
    "l4_hardcoded": "pydephasing/quantum/exports/qpe_hardcoded_sector_run_L4_blocked.json"
  },
  "precision_target_abs_delta": threshold,
  "results": [
    {
      "L": 3,
      "hardcoded_vqe_energy": hard_l3,
      "qiskit_vqe_energy": qiskit_l3,
      "abs_delta": delta_l3,
      "within_l2_precision_target": bool(delta_l3<=threshold)
    },
    {
      "L": 4,
      "hardcoded_vqe_energy": hard_l4,
      "qiskit_vqe_energy": qiskit_l4,
      "abs_delta": delta_l4,
      "within_l2_precision_target": bool(delta_l4<=threshold)
    }
  ]
}
(root/"hardcoded_vs_qiskit_l3_l4_followup_metrics.json").write_text(json.dumps(payload,indent=2),encoding="utf-8")

lines=[
"# L=3/L=4 Follow-up Comparison",
"",
"After L=2 phase1 lock-match, this compares hardcoded vs Qiskit energies for L=3/L=4 using committed test artifacts.",
"",
f"- Precision target (abs delta): {threshold:.1e}",
"",
"## L=3",
f"- hardcoded_vqe_energy: {hard_l3:.15f}",
f"- qiskit_vqe_energy:   {qiskit_l3:.15f}",
f"- abs_delta:           {delta_l3:.15e}",
f"- within target:       {delta_l3<=threshold}",
"",
"## L=4",
f"- hardcoded_vqe_energy: {hard_l4:.15f}",
f"- qiskit_vqe_energy:   {qiskit_l4:.15f}",
f"- abs_delta:           {delta_l4:.15e}",
f"- within target:       {delta_l4<=threshold}",
"",
"## Source Artifacts",
"- `Tests/vqe_hardcoded_vs_qiskit_comparison.json`",
"- `Tests/vqe_l4_longrun_results.json`",
"- `pydephasing/quantum/exports/qpe_hardcoded_sector_run_L4_blocked.json`",
]
(root/"hardcoded_vs_qiskit_l3_l4_followup_report.md").write_text("\n".join(lines),encoding="utf-8")
print("Wrote hardcoded_vs_qiskit_l3_l4_followup_metrics.json")
print("Wrote hardcoded_vs_qiskit_l3_l4_followup_report.md")
print("L3 delta",delta_l3)
print("L4 delta",delta_l4)
PY
python - <<"PY"
import json
from pathlib import Path
obj=json.loads(Path("pydephasing/quantum/exports/qpe_hardcoded_sector_run_L4_blocked.json").read_text())
print(obj.keys())
for k,v in obj.items():
    if isinstance(v,dict):
        print(k, list(v.keys())[:20])
PY
python - <<"PY"
import json
from datetime import datetime
from pathlib import Path
root=Path(".")

l3_cmp=json.loads((root/"Tests/vqe_hardcoded_vs_qiskit_comparison.json").read_text())
l3_row=None
for row in l3_cmp.get("comparison",[]):
    if int(row.get("lattice_sites",-1))==3:
        l3_row=row
        break
if l3_row is None:
    raise RuntimeError("L3 entry missing in Tests/vqe_hardcoded_vs_qiskit_comparison.json")

hard_l3=float(l3_row["hardcoded_vqe_energy"])
qiskit_l3=float(l3_row["qiskit_vqe_energy"])
delta_l3=abs(hard_l3-qiskit_l3)

qk_l4=json.loads((root/"Tests/vqe_l4_longrun_results.json").read_text())
qiskit_l4=float(qk_l4["results"]["best_vqe_energy_observed"])

hc_l4_src=json.loads((root/"pydephasing/quantum/exports/qpe_hardcoded_sector_run_L4_blocked.json").read_text())
hard_l4=float(hc_l4_src["reference"]["E_vqe"])
delta_l4=abs(hard_l4-qiskit_l4)

threshold=1e-4
payload={
  "generated_utc": datetime.utcnow().isoformat()+"Z",
  "description": "Follow-up L=3/L=4 hardcoded-vs-Qiskit comparison using existing test artifacts after L=2 phase1 lock-match.",
  "sources": {
    "l3": "Tests/vqe_hardcoded_vs_qiskit_comparison.json",
    "l4_qiskit": "Tests/vqe_l4_longrun_results.json",
    "l4_hardcoded": "pydephasing/quantum/exports/qpe_hardcoded_sector_run_L4_blocked.json"
  },
  "precision_target_abs_delta": threshold,
  "results": [
    {
      "L": 3,
      "hardcoded_vqe_energy": hard_l3,
      "qiskit_vqe_energy": qiskit_l3,
      "abs_delta": delta_l3,
      "within_l2_precision_target": bool(delta_l3<=threshold)
    },
    {
      "L": 4,
      "hardcoded_vqe_energy": hard_l4,
      "qiskit_vqe_energy": qiskit_l4,
      "abs_delta": delta_l4,
      "within_l2_precision_target": bool(delta_l4<=threshold)
    }
  ]
}
(root/"hardcoded_vs_qiskit_l3_l4_followup_metrics.json").write_text(json.dumps(payload,indent=2),encoding="utf-8")

lines=[
"# L=3/L=4 Follow-up Comparison",
"",
"After L=2 phase1 lock-match, this compares hardcoded vs Qiskit energies for L=3/L=4 using committed test artifacts.",
"",
f"- Precision target (abs delta): {threshold:.1e}",
"",
"## L=3",
f"- hardcoded_vqe_energy: {hard_l3:.15f}",
f"- qiskit_vqe_energy:   {qiskit_l3:.15f}",
f"- abs_delta:           {delta_l3:.15e}",
f"- within target:       {delta_l3<=threshold}",
"",
"## L=4",
f"- hardcoded_vqe_energy: {hard_l4:.15f}",
f"- qiskit_vqe_energy:   {qiskit_l4:.15f}",
f"- abs_delta:           {delta_l4:.15e}",
f"- within target:       {delta_l4<=threshold}",
"",
"## Source Artifacts",
"- `Tests/vqe_hardcoded_vs_qiskit_comparison.json`",
"- `Tests/vqe_l4_longrun_results.json`",
"- `pydephasing/quantum/exports/qpe_hardcoded_sector_run_L4_blocked.json`",
]
(root/"hardcoded_vs_qiskit_l3_l4_followup_report.md").write_text("\n".join(lines),encoding="utf-8")
print("Wrote hardcoded_vs_qiskit_l3_l4_followup_metrics.json")
print("Wrote hardcoded_vs_qiskit_l3_l4_followup_report.md")
print("L3 delta",delta_l3)
print("L4 delta",delta_l4)
PY
sed -n "1,260p" hardcoded_vs_qiskit_l3_l4_followup_report.md
cat hardcoded_vs_qiskit_l3_l4_followup_metrics.json
ps aux | rg "python - <<\"PY\"|vqe_minimize|hardcoded VQE|98106" -n
git status --short
rm -f hardcoded_vs_qiskit_l2_match_metrics_iter2.json hardcoded_vs_qiskit_l2_match_metrics_iter3.json hardcoded_vs_qiskit_l2_match_metrics_iter4.json hardcoded_vs_qiskit_l2_match_metrics_iter5.json hardcoded_vs_qiskit_l2_match_report_iter2.md hardcoded_vs_qiskit_l2_match_report_iter3.md hardcoded_vs_qiskit_l2_match_report_iter4.md hardcoded_vs_qiskit_l2_match_report_iter5.md
python - <<"PY"
import json
from pathlib import Path
obj=json.loads(Path("hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
print("pass",obj["pass"],"final_iter",obj["final_iteration_index"])
print("iterations",obj["iterations"])
PY
sed -n "1,260p" hardcoded_vs_qiskit_l2_match_final_report.md
git status --short
python - <<"PY"
import json
from pathlib import Path
m=json.loads(Path("hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
fm=m["final_metrics"]
print("pass",m["pass"],"iter",m["final_iteration_index"])
print("gs",fm["ground_state_energy"]["abs_delta"])
for k in ["fidelity","energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter"]:
    print(k,fm["trajectory_deltas"][k]["max_abs_delta"])

f=json.loads(Path("hardcoded_vs_qiskit_l3_l4_followup_metrics.json").read_text())
for row in f["results"]:
    print("L",row["L"],"delta",row["abs_delta"],"within",row["within_l2_precision_target"])
PY
rg -n "plot|pdf|savefig|PdfPages|dynamics" Tests/hubbard_dimer_suzuki_trotter_standalone.py
sed -n "320,560p" Tests/hubbard_dimer_suzuki_trotter_standalone.py
sed -n "560,980p" Tests/hubbard_dimer_suzuki_trotter_standalone.py
python - <<"PY"
import json
from pathlib import Path
nb=json.loads(Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb").read_text())
for i,cell in enumerate(nb["cells"]):
    if cell.get("cell_type")!="code":
        continue
    src="".join(cell.get("source",[]))
    if "def apply_pauli_rotation" in src:
        print("cell",i)
        print(src[:2200])
        break
PY
python - <<"PY"
import json
from pathlib import Path
nb=json.loads(Path("pydephasing/quantum/vqe_latex_python_pairs_test.ipynb").read_text())
for i,cell in enumerate(nb["cells"]):
    if cell.get("cell_type")!="code":
        continue
    src="".join(cell.get("source",[]))
    if "def apply_pauli_string" in src:
        print("cell",i)
        print(src[:3200])
        break
PY
python - <<"PY"
from qiskit_nature.second_q.hamiltonians import FermiHubbardModel
from qiskit_nature.second_q.hamiltonians.lattices import BoundaryCondition, LineLattice
from qiskit_nature.second_q.mappers import JordanWignerMapper

def terms(L):
    lattice=LineLattice(num_nodes=L,edge_parameter=-1.0,onsite_parameter=0.0,boundary_condition=BoundaryCondition.PERIODIC)
    ferm=FermiHubbardModel(lattice=lattice, onsite_interaction=4.0).second_q_op()
    # blocked ordering
    perm=[i for site in range(L) for i in (site,L+site)]
    ferm=ferm.permute_indices(perm)
    q=JordanWignerMapper().map(ferm).simplify(atol=1e-12)
    return len(q.to_list())
for L in [2,3,4]:
    print(L, terms(L))
PY
python Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
python Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
sed -n "1,90p" Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
python Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
python Tests/phase1_l2_hardcoded_match_harness.py
cat hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json
python - <<"PY"
from pathlib import Path
files=[
"hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
"hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
"hardcoded_vs_qiskit_l2_match_final_report.pdf",
"hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
"hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
"hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
]
for f in files:
    p=Path(f)
    print(f, p.exists(), p.stat().st_size if p.exists() else None)
PY
python - <<"PY"
import json
from pathlib import Path
for L in [3,4]:
    p=Path(f"hardcoded_vs_qiskit_l{L}_time_dynamics_metrics.json")
    obj=json.loads(p.read_text())
    m=obj["metrics"]
    print("\nL",L,"PASS",m["acceptance"]["pass"])
    print("gs",m["ground_state_energy_abs_delta"])
    for k in ["fidelity","energy_trotter","n_up_site0_trotter","n_dn_site0_trotter","doublon_trotter"]:
        print(k,m["trajectory_deltas"][k]["max_abs_delta"])
PY
git status --short
rm -f hardcoded_vs_qiskit_l3_l4_followup_metrics.json hardcoded_vs_qiskit_l3_l4_followup_report.md
python - <<"PY"
import json
from pathlib import Path
import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages

root=Path(".")
l2=json.loads((root/"hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
l34=json.loads((root/"hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())

pdf_path=root/"hardcoded_vs_qiskit_l2_l4_overall_summary.pdf"
with PdfPages(str(pdf_path)) as pdf:
    fig=plt.figure(figsize=(11,8.5))
    ax=fig.add_subplot(111)
    ax.axis("off")
    fm=l2["final_metrics"]
    td=fm["trajectory_deltas"]
    lines=[
        "Hardcoded vs Qiskit Overall Summary (L=2..4)",
        "",
        f"L=2 PASS: {l2[pass]} (iter{l2[final_iteration_index]})",
        f"  gs delta: {fm[ground_state_energy][abs_delta]:.12e}",
        f"  fidelity max delta: {td[fidelity][max_abs_delta]:.12e}",
        f"  energy_trotter max delta: {td[energy_trotter][max_abs_delta]:.12e}",
        f"  n_up_site0_trotter max delta: {td[n_up_site0_trotter][max_abs_delta]:.12e}",
        f"  n_dn_site0_trotter max delta: {td[n_dn_site0_trotter][max_abs_delta]:.12e}",
        f"  doublon_trotter max delta: {td[doublon_trotter][max_abs_delta]:.12e}",
        "",
        f"L=3/L=4 all-pass: {l34[all_pass]}",
    ]
    for row in l34["results"]:
        lines.append(f"  L={row[lattice_size]} PASS={row[pass]} max coeff delta={row[max_abs_coeff_delta]:.3e}")
        for k,v in row["trajectory_max_abs_deltas"].items():
            lines.append(f"    {k}: {v:.12e}")
    lines += [
        "",
        "PDF Artifacts:",
        "- hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
        "- hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
        "- hardcoded_vs_qiskit_l2_match_final_report.pdf",
        "- hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
    ]
    ax.text(0.02,0.98,"\n".join(lines),va="top",ha="left",family="monospace",fontsize=9)
    pdf.savefig(fig)
    plt.close(fig)
print(f"Wrote {pdf_path}")
PY
python - <<"PY"
import json
from pathlib import Path
import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages

root = Path(".")
l2 = json.loads((root / "hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
l34 = json.loads((root / "hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())

pdf_path = root / "hardcoded_vs_qiskit_l2_l4_overall_summary.pdf"
with PdfPages(str(pdf_path)) as pdf:
    fig = plt.figure(figsize=(11, 8.5))
    ax = fig.add_subplot(111)
    ax.axis("off")

    fm = l2["final_metrics"]
    td = fm["trajectory_deltas"]

    lines = [
        "Hardcoded vs Qiskit Overall Summary (L=2..4)",
        "",
        f"L=2 PASS: {l2[pass]} (iter{l2[final_iteration_index]})",
        f"  gs delta: {fm[ground_state_energy][abs_delta]:.12e}",
        f"  fidelity max delta: {td[fidelity][max_abs_delta]:.12e}",
        f"  energy_trotter max delta: {td[energy_trotter][max_abs_delta]:.12e}",
        f"  n_up_site0_trotter max delta: {td[n_up_site0_trotter][max_abs_delta]:.12e}",
        f"  n_dn_site0_trotter max delta: {td[n_dn_site0_trotter][max_abs_delta]:.12e}",
        f"  doublon_trotter max delta: {td[doublon_trotter][max_abs_delta]:.12e}",
        "",
        f"L=3/L=4 all-pass: {l34[all_pass]}",
    ]

    for row in l34["results"]:
        lines.append(f"  L={row[lattice_size]} PASS={row[pass]} max coeff delta={row[max_abs_coeff_delta]:.3e}")
        for k, v in row["trajectory_max_abs_deltas"].items():
            lines.append(f"    {k}: {v:.12e}")

    lines += [
        "",
        "PDF Artifacts:",
        "- hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
        "- hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
        "- hardcoded_vs_qiskit_l2_match_final_report.pdf",
        "- hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
    ]

    ax.text(0.02, 0.98, "\n".join(lines), va="top", ha="left", family="monospace", fontsize=9)
    pdf.savefig(fig)
    plt.close(fig)

print(f"Wrote {pdf_path}")
PY
python - <<"PY"
import json
from pathlib import Path
import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages

root = Path(".")
l2 = json.loads((root / "hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
l34 = json.loads((root / "hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())

pdf_path = root / "hardcoded_vs_qiskit_l2_l4_overall_summary.pdf"
with PdfPages(str(pdf_path)) as pdf:
    fig = plt.figure(figsize=(11, 8.5))
    ax = fig.add_subplot(111)
    ax.axis("off")

    fm = l2["final_metrics"]
    td = fm["trajectory_deltas"]

    lines = [
        "Hardcoded vs Qiskit Overall Summary (L=2..4)",
        "",
        f"L=2 PASS: {l2[\"pass\"]} (iter{l2[\"final_iteration_index\"]})",
        f"  gs delta: {fm[\"ground_state_energy\"][\"abs_delta\"]:.12e}",
        f"  fidelity max delta: {td[\"fidelity\"][\"max_abs_delta\"]:.12e}",
        f"  energy_trotter max delta: {td[\"energy_trotter\"][\"max_abs_delta\"]:.12e}",
        f"  n_up_site0_trotter max delta: {td[\"n_up_site0_trotter\"][\"max_abs_delta\"]:.12e}",
        f"  n_dn_site0_trotter max delta: {td[\"n_dn_site0_trotter\"][\"max_abs_delta\"]:.12e}",
        f"  doublon_trotter max delta: {td[\"doublon_trotter\"][\"max_abs_delta\"]:.12e}",
        "",
        f"L=3/L=4 all-pass: {l34[\"all_pass\"]}",
    ]

    for row in l34["results"]:
        lines.append(f"  L={row[\"lattice_size\"]} PASS={row[\"pass\"]} max coeff delta={row[\"max_abs_coeff_delta\"]:.3e}")
        for k, v in row["trajectory_max_abs_deltas"].items():
            lines.append(f"    {k}: {v:.12e}")

    lines += [
        "",
        "PDF Artifacts:",
        "- hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
        "- hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
        "- hardcoded_vs_qiskit_l2_match_final_report.pdf",
        "- hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
    ]

    ax.text(0.02, 0.98, "\n".join(lines), va="top", ha="left", family="monospace", fontsize=9)
    pdf.savefig(fig)
    plt.close(fig)

print(f"Wrote {pdf_path}")
PY
python - <<"PY"
import json
from pathlib import Path
import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages

root = Path(".")
l2 = json.loads((root / "hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
l34 = json.loads((root / "hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())

fm = l2["final_metrics"]
td = fm["trajectory_deltas"]
l2_pass = l2["pass"]
l2_iter = l2["final_iteration_index"]

gs = fm["ground_state_energy"]["abs_delta"]
fid = td["fidelity"]["max_abs_delta"]
ene = td["energy_trotter"]["max_abs_delta"]
nu = td["n_up_site0_trotter"]["max_abs_delta"]
nd = td["n_dn_site0_trotter"]["max_abs_delta"]
db = td["doublon_trotter"]["max_abs_delta"]
l34_pass = l34["all_pass"]

pdf_path = root / "hardcoded_vs_qiskit_l2_l4_overall_summary.pdf"
with PdfPages(str(pdf_path)) as pdf:
    fig = plt.figure(figsize=(11, 8.5))
    ax = fig.add_subplot(111)
    ax.axis("off")

    lines = [
        "Hardcoded vs Qiskit Overall Summary (L=2..4)",
        "",
        f"L=2 PASS: {l2_pass} (iter{l2_iter})",
        f"  gs delta: {gs:.12e}",
        f"  fidelity max delta: {fid:.12e}",
        f"  energy_trotter max delta: {ene:.12e}",
        f"  n_up_site0_trotter max delta: {nu:.12e}",
        f"  n_dn_site0_trotter max delta: {nd:.12e}",
        f"  doublon_trotter max delta: {db:.12e}",
        "",
        f"L=3/L=4 all-pass: {l34_pass}",
    ]

    for row in l34["results"]:
        lines.append(f"  L={row[lattice_size]} PASS={row[pass]} max coeff delta={row[max_abs_coeff_delta]:.3e}")
        for k, v in row["trajectory_max_abs_deltas"].items():
            lines.append(f"    {k}: {v:.12e}")

    lines += [
        "",
        "PDF Artifacts:",
        "- hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
        "- hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
        "- hardcoded_vs_qiskit_l2_match_final_report.pdf",
        "- hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
    ]

    ax.text(0.02, 0.98, "\n".join(lines), va="top", ha="left", family="monospace", fontsize=9)
    pdf.savefig(fig)
    plt.close(fig)

print(f"Wrote {pdf_path}")
PY
python - <<"PY"
import json
from pathlib import Path
import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages

root = Path(".")
l2 = json.loads((root / "hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
l34 = json.loads((root / "hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())

fm = l2["final_metrics"]
td = fm["trajectory_deltas"]

pdf_path = root / "hardcoded_vs_qiskit_l2_l4_overall_summary.pdf"
with PdfPages(str(pdf_path)) as pdf:
    fig = plt.figure(figsize=(11, 8.5))
    ax = fig.add_subplot(111)
    ax.axis("off")

    lines = [
        "Hardcoded vs Qiskit Overall Summary (L=2..4)",
        "",
        f"L=2 PASS: {l2[\"pass\"]} (iter{l2[\"final_iteration_index\"]})",
        f"  gs delta: {fm[\"ground_state_energy\"][\"abs_delta\"]:.12e}",
        f"  fidelity max delta: {td[\"fidelity\"][\"max_abs_delta\"]:.12e}",
        f"  energy_trotter max delta: {td[\"energy_trotter\"][\"max_abs_delta\"]:.12e}",
        f"  n_up_site0_trotter max delta: {td[\"n_up_site0_trotter\"][\"max_abs_delta\"]:.12e}",
        f"  n_dn_site0_trotter max delta: {td[\"n_dn_site0_trotter\"][\"max_abs_delta\"]:.12e}",
        f"  doublon_trotter max delta: {td[\"doublon_trotter\"][\"max_abs_delta\"]:.12e}",
        "",
        f"L=3/L=4 all-pass: {l34[\"all_pass\"]}",
    ]

    for row in l34["results"]:
        lattice = row["lattice_size"]
        passed = row["pass"]
        maxc = row["max_abs_coeff_delta"]
        lines.append(f"  L={lattice} PASS={passed} max coeff delta={maxc:.3e}")
        for k, v in row["trajectory_max_abs_deltas"].items():
            lines.append(f"    {k}: {v:.12e}")

    lines += [
        "",
        "PDF Artifacts:",
        "- hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
        "- hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
        "- hardcoded_vs_qiskit_l2_match_final_report.pdf",
        "- hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
    ]

    ax.text(0.02, 0.98, "\n".join(lines), va="top", ha="left", family="monospace", fontsize=9)
    pdf.savefig(fig)
    plt.close(fig)

print(f"Wrote {pdf_path}")
PY
python - <<"PY"
import json
from pathlib import Path
import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages

root = Path(".")
l2 = json.loads((root / "hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
l34 = json.loads((root / "hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())

l2_pass = l2["pass"]
l2_iter = l2["final_iteration_index"]
fm = l2["final_metrics"]
td = fm["trajectory_deltas"]

gs = fm["ground_state_energy"]["abs_delta"]
fid = td["fidelity"]["max_abs_delta"]
ene = td["energy_trotter"]["max_abs_delta"]
nu = td["n_up_site0_trotter"]["max_abs_delta"]
nd = td["n_dn_site0_trotter"]["max_abs_delta"]
db = td["doublon_trotter"]["max_abs_delta"]
all_pass = l34["all_pass"]

pdf_path = root / "hardcoded_vs_qiskit_l2_l4_overall_summary.pdf"
with PdfPages(str(pdf_path)) as pdf:
    fig = plt.figure(figsize=(11, 8.5))
    ax = fig.add_subplot(111)
    ax.axis("off")

    lines = [
        "Hardcoded vs Qiskit Overall Summary (L=2..4)",
        "",
        "L=2 PASS: {} (iter{})".format(l2_pass, l2_iter),
        "  gs delta: {:.12e}".format(gs),
        "  fidelity max delta: {:.12e}".format(fid),
        "  energy_trotter max delta: {:.12e}".format(ene),
        "  n_up_site0_trotter max delta: {:.12e}".format(nu),
        "  n_dn_site0_trotter max delta: {:.12e}".format(nd),
        "  doublon_trotter max delta: {:.12e}".format(db),
        "",
        "L=3/L=4 all-pass: {}".format(all_pass),
    ]

    for row in l34["results"]:
        lattice = row["lattice_size"]
        passed = row["pass"]
        maxc = row["max_abs_coeff_delta"]
        lines.append("  L={} PASS={} max coeff delta={:.3e}".format(lattice, passed, maxc))
        for k, v in row["trajectory_max_abs_deltas"].items():
            lines.append("    {}: {:.12e}".format(k, v))

    lines += [
        "",
        "PDF Artifacts:",
        "- hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
        "- hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
        "- hardcoded_vs_qiskit_l2_match_final_report.pdf",
        "- hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
        "- hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
    ]

    ax.text(0.02, 0.98, "\n".join(lines), va="top", ha="left", family="monospace", fontsize=9)
    pdf.savefig(fig)
    plt.close(fig)

print("Wrote {}".format(pdf_path))
PY
python - <<"PY"
import json
from pathlib import Path
m=json.loads(Path("hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
print("l2 pass",m["pass"],"iter",m["final_iteration_index"])
print("checks",m["final_metrics"]["acceptance"]["checks"])
s=json.loads(Path("hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())
print("l34 all pass",s["all_pass"])
PY
python - <<"PY"
from pathlib import Path
files=[
"hardcoded_vs_qiskit_l2_match_report_iter0.pdf",
"hardcoded_vs_qiskit_l2_match_report_iter1.pdf",
"hardcoded_vs_qiskit_l2_match_final_report.pdf",
"hardcoded_vs_qiskit_l3_time_dynamics_report.pdf",
"hardcoded_vs_qiskit_l4_time_dynamics_report.pdf",
"hardcoded_vs_qiskit_vqe_energy_comparison.pdf",
"hardcoded_vs_qiskit_l2_l4_overall_summary.pdf",
]
for f in files:
    p=Path(f)
    print(f,p.exists(),p.stat().st_size if p.exists() else None)
PY
rg -n "ITER0_REPORT_PATH|FINAL_REPORT_PATH|final_report_lines|_write_iter_report\(|report_md|Wrote iter0" Tests/phase1_l2_hardcoded_match_harness.py
sed -n "1,120p" Tests/phase1_l2_hardcoded_match_harness.py
sed -n "540,900p" Tests/phase1_l2_hardcoded_match_harness.py
sed -n "900,1020p" Tests/phase1_l2_hardcoded_match_harness.py
rg -n "ITER0_REPORT_PATH|FINAL_REPORT_PATH|report_md|_write_iter_report\(" Tests/phase1_l2_hardcoded_match_harness.py
python Tests/phase1_l2_hardcoded_match_harness.py
rm -f hardcoded_vs_qiskit_l2_match_report_iter0.md hardcoded_vs_qiskit_l2_match_report_iter1.md hardcoded_vs_qiskit_l2_match_final_report.md
rg -n "\.md|report_md|ITER0_REPORT_PATH|FINAL_REPORT_PATH" Tests/phase1_l2_hardcoded_match_harness.py
python Tests/phase1_l2_hardcoded_match_harness.py
python - <<"PY"
from pathlib import Path
for f in ["hardcoded_vs_qiskit_l2_match_report_iter0.md","hardcoded_vs_qiskit_l2_match_report_iter1.md","hardcoded_vs_qiskit_l2_match_final_report.md"]:
    print(f, Path(f).exists())
PY
python - <<"PY"
import json
from pathlib import Path
l2=json.loads(Path("hardcoded_vs_qiskit_l2_match_final_metrics.json").read_text())
l34=json.loads(Path("hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())
print("l2 pass",l2["pass"],"iter",l2["final_iteration_index"])
print("l34 all pass",l34["all_pass"])
PY
git status --short
rg -n "def _simulate_one_path|def _write_pdf|trajectory|exact_states|energy_trotter|n_up_site0_trotter|doublon_trotter" Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
sed -n "220,460p" Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
sed -n "460,760p" Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
python -m py_compile Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
python Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
python - <<"PY"
import json
from pathlib import Path
s=json.loads(Path("hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())
print("all_pass",s["all_pass"])
for row in s["results"]:
    print(row["lattice_size"],row["pass"],row["report_pdf"])
PY
python - <<"PY"
from pathlib import Path
for f in ["hardcoded_vs_qiskit_l3_time_dynamics_report.pdf","hardcoded_vs_qiskit_l4_time_dynamics_report.pdf"]:
    p=Path(f)
    print(f,p.exists(),p.stat().st_size if p.exists() else None)
PY
git status --short Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py site0_exact_reference_values_l2_l3_l4.json
nl -ba Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py | sed -n "330,590p"
python -m py_compile Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
python Tests/l3_l4_hardcoded_vs_qiskit_time_dynamics_pdf.py
gs -dBATCH -dNOPAUSE -q -sDEVICE=pdfwrite -sOutputFile=hardcoded_vs_qiskit_all_results_bundle.pdf hardcoded_vs_qiskit_l2_match_final_report.pdf hardcoded_vs_qiskit_l3_time_dynamics_report.pdf hardcoded_vs_qiskit_l4_time_dynamics_report.pdf hardcoded_vs_qiskit_vqe_energy_comparison.pdf hardcoded_vs_qiskit_l2_l4_overall_summary.pdf
ls -lh hardcoded_vs_qiskit_all_results_bundle.pdf hardcoded_vs_qiskit_l3_time_dynamics_report.pdf hardcoded_vs_qiskit_l4_time_dynamics_report.pdf hardcoded_vs_qiskit_vqe_energy_comparison.pdf
python - <<"PY"
import json
from pathlib import Path
s=json.loads(Path("hardcoded_vs_qiskit_l3_l4_time_dynamics_summary.json").read_text())
print("all_pass",s["all_pass"])
for row in s["results"]:
    print("L",row["lattice_size"],"pass",row["pass"]) 
PY
